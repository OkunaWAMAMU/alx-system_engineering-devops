#!/usr/bin/env bash
# This script displays listening ports and shows the PID and name of the program to which each socket belongs

# Display active internet connections
echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"

# Display TCP and UDP listening sockets with PID/Program name
ss -tunlp | awk '
BEGIN { FS="[ \t\n]+"; OFS=" " }
NR>1 && ($1 ~ /^(tcp|udp)/) && ($4 ~ /LISTEN/) {
  gsub("users:(\"","users:(", $6)
  gsub("\")",")", $6)
  printf "%-4s %5s %5s %-21s %-21s %-10s %-14s\n", $1, $2, $3, $4, $5, $6, $7
}'

# Display active UNIX domain sockets
echo "Active UNIX domain sockets (only servers)"
echo "Proto RefCnt Flags       Type       State         I-Node   PID/Program name    Path"

# Display UNIX domain listening sockets with PID/Program name
ss -xlnp | awk '
BEGIN { FS="[ \t\n]+"; OFS=" " }
NR>1 && ($1 ~ /^(unix|u_str|u_dgr|u_seq)/) && ($4 == "LISTENING") {
  gsub("users:(\"","users:(", $6)
  gsub("\")",")", $6)
  printf "%-4s %5s %-10s %-11s %-11s %-6s %-14s %-30s\n", $1, $2, $3, $4, $5, $6, $7, $8
}'

